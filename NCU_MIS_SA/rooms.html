<!doctype html>
<html lang="en">

<head>
<!-- Basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">   
   
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">	
 
     <!-- Site Metas -->
    <title>Wundon Xican-桑幾勒</title>  
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Site Icons -->
    <link rel="shortcut icon" href="statics/images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="statics/images/apple-touch-icon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="statics/css/bootstrap.min.css">
    <!-- Site CSS -->
    <link rel="stylesheet" href="statics/css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="statics/css/responsive.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="statics/css/custom.css">
	<script src="statics/js/modernizr.js"></script> <!-- Modernizr -->

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.statics/js/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <style>
		body {font-family: Arial, Helvetica, sans-serif;}

		/* The Modal (background) */
		.modal {
		  display: none; /* Hidden by default */
		  position: fixed; /* Stay in place */
		  z-index: 1; /* Sit on top */
		  padding-top: 100px; /* Location of the box */
		  left: 0;
		  top: 0;
		  width: 100%; /* Full width */
		  height: 100%; /* Full height */
		  overflow: auto; /* Enable scroll if needed */
		  background-color: rgb(0,0,0); /* Fallback color */
		  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
		}

		/* Modal Content */
		.modal-content {
		  z-index:9999;
		  background-color: #fefefe;
		  margin: auto;
		  padding: 20px;
		  border: 1px solid #888;
		  width: 80%;
		}
		
		/* The Close Button */
		.close {
		  color: #aaaaaa;
		  float: right;
		  font-size: 28px;
		  font-weight: bold;
		}
		
		.close:hover,
		.close:focus {
		  color: #000;
		  text-decoration: none;
		  cursor: pointer;
		}
		.modal-backdrop { display: none; } 
		.modal { background: rgba(0,0,0,0.5);}
		
		.fa fa-quote-left {
			color:white;
		} 
		
		
	</style>
</head>

<body>
	    <!-- LOADER -->
<!--     <div id="preloader"> -->
<!--         <div id="main-ld"> -->
<!-- 			<div id="loader"></div>   -->
<!-- 		</div> -->
<!--     </div>end loader -->
  <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
    <h5 class="my-0 mr-md-auto font-weight-normal">NCU_MIS-SA</h5>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
      <div class="container-fluid">
        <a class="navbar-brand js-scroll-trigger" href="#page-top">
			<img class="img-fluid" src="statics/images/logo.png" alt="" />
		</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          Menu
          <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="index.html">首頁</a>
            </li>
  	        <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="manager.html">管理員登入</a>
          	</li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="register.html">註冊/登入</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger active" href="rooms.html">房間列表</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="createroom.html">創建房間</a>
            </li>
			<li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="profile.html">個人資料</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="joinedroomlist.html">已加入房間</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </div>

  <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
    <h3 class="display-4">房間列表</h3>
    <p class="lead">以下是所有房間包含其ID、房間名稱、運動類型與其他說明</p>
  </div>
  
 	<div id="get" class="gallery-list row"> 
	</div>
	

	<div id="get2">
	</div> 

  <div class="album py-5 bg-light">
    <div class="container">
      <div id="product_panel" class="row">
      </div>
    </div>
  </div>
	<script>

    $('.modal').on('shown.bs.modal', function() {
        // prevent modal appear under background
        $(this).appendTo("body");
    })
    
	</script>
  <script>  

  function test(obj){
	     if( obj == '加入房間' ){
	      document.getElementById('s1').value = '已加入';
	     }
	     else{
	      document.getElementById('s1').disabled = true;
	      alert('您已加入此房間')
	     }
	    }
  
//   	function changeValue(){
  		
//   		var s1val = document.getElementById("s1");
//   		if (s1val.value=="加入房間"){
//   			s1val.value=="已加入";
//   		}
//   	}
	
  $(document).ready(function(){
	  
 	  
    	function getAllRoom() {
    	$.ajax({
        type: "GET",
        url: "api/room.do",
        crossDomain: true,
        cache: false,
        dataType: 'json',
        timeout: 5000,
        success: function (response) {
          if (response.status == 200) {
        	    var Room_panel = '';
        		var count = 1;
        		$.each(response.response.data, function (index,value){
//         			alert(JSON.stringify(value));
        			//Room_panel += addRoom(this,count);
        			$("#get").append(addRoom(value,count));
        			count++;
        		})
        	
        			//$("#get").append(Room_panel);
        	//setButtonFunction();
        	//checkIfExistInCart();
        	//var $submit= $("#s"+^[0-9]+$);
        		
          	
        		$(".Auto").on("click",function(){
        			var ID= $(this).attr("id");
//         			alert("房間編號為"+ID);
//         			alert("第一次按為初始化 麻煩請按第二次")
        			
        			$.ajax({
        		    	type: "GET",
        		        url: "api/room.do",
        		        crossDomain: true,
        		        cache: false,
        		        data: {id:ID},
        		        dataType: 'json',
        		        timeout: 5000,
        		        success: function (response) {
        		          	if (response.status == 200  ) {	
        		          		var Room_panel = '';
        		   				$.each(response.response.data , function (index,value){		        		      		        	
        		        			Room_panel+= addRoomdetail(value,JSON.stringify(value.Id));  
//         		    				alert(Room_panel);		        	      			    	
        		        	})
        		        	$("#get2").append(Room_panel);	
        		          }
        		        },
        		        error: function () {
        				alert("喜勒考喔");
        		            }
        		       
        		      });
        		function addRoomdetail(response, count){
				//alert(JSON.stringify(response.Name));
        		let inner_html ='';	
         		inner_html+='<div class="modal fade" id="exampleModalLong'+count+'"tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">';
        		inner_html+='<div class="modal-dialog" role="document">';
        		inner_html+='<div class="modal-content">';
        		inner_html+='<div class="modal-header">';
        		inner_html+='<h5 class="modal-title" id="exampleModalLongTitle">以下為您所選房間之詳細資料</h5>';
        		inner_html+='<button type="button" class="close" data-dismiss="modal" aria-label="Close">';
        		inner_html+='<span aria-hidden="true">&times;</span></button></div><div class="modal-body">';        		
        	
        		inner_html+="房間名稱:<p id='roomName'>"+JSON.stringify(response.Name)+"</p><br>";       	
     
        		inner_html+="運動類型"+JSON.stringify(response.Type)+"<br>";
        		inner_html+="活動時間"+JSON.stringify(response.Date)+"<br>";
        		inner_html+="活動地點"+JSON.stringify(response.Place	)+"<br>";
        		inner_html+="人數限制"+JSON.stringify(response.Maxmember	)+"<br>";
        		inner_html+="性別限制"+JSON.stringify(response.GenderRestriction	)+"<br>";
        		inner_html+="年齡上限"+JSON.stringify(response.AgeUpperlimit	)+"<br>";
        		inner_html+="年齡下限"+JSON.stringify(response.AgeLowerlimit	)+"<br>";
        		//inner_html+="房間描述"+response.response.data[0].Description+"<br>";
        		inner_html+='</div><div class="modal-footer">';
        		inner_html+='<div class="btn btn-secondary">';
        		inner_html+='<button type="button" class="btn-light hvr-rectangle-out" data-dismiss="modal">確定</button>';
        		inner_html+='<input type="button" class="btn-light hvr-rectangle-out auto" id="'+count+'" value="加入房間">';
        		
        		inner_html+='</div></div></div></div></div>';
//         		alert(inner_html);
        		
        		
        		$(".auto").on("click",function(){
        		  var room_Id = $(this).attr("id");
        		  var Name =JSON.stringify(response.Name);
  		          var Place =JSON.stringify(response.Place);
  		          var Date = JSON.stringify(response.Date);
  		          var Type = JSON.stringify(response.Type);               
  		          var Id= localStorage.getItem('currentID');
  			

  		              // 將資料組成JSON格式
  		              
  		              var data_object = {
  		                  "Name": Name,
  		                  "Place": Place,
  		                  "Date": Date,
  		                  "Type": Type,
  						  "Id":Id,
  						  "room_Id":room_Id
  		              };

  		              // 將JSON格式轉換成字串
  		              var data_string = JSON.stringify(data_object);

  		              // 發出POST的AJAX請求
  		              $.ajax({
  		                      type: "POST",
  		                      url: "api/joinedroomlist.do",
  		                      data: data_string,
  		                      crossDomain: true,
  		                      cache: false,
  		                      dataType: 'json',
  		                      timeout: 5000,
  		                      success: function (response) {
  		                          if(response.status == 200){
  		                              alert("加入 successfully!!");
  		                            $(".auto").val("  已加入  ");
  		              		    	$(".auto").attr("disabled",true);
  		                          }
  		                      },
  		                      error: function () {
  		                          alert("無法連線到伺服器！");
  		                      }
  		              });
  		              
  		          
  		      
// 			alert("成功加入房間");
  			var ID=  $(this).attr("id");
  		  
			
  		})
  		return inner_html;
        		}       	
        	});     
          }
        },
        error: function () {
          
 			alert("王八蛋");  }
     
    	});
 	  	}
    getAllRoom();
    
    
    function addRoom(data,count) {
    	
    	let inner_html = '';
    	inner_html += ' <div class="col-md-4 col-sm-6 gallery-grid gal_a gal_b"> <div class="gallery-single fix" style="z-index:1;"> <div class="desc"> <h3 style="color:#fff;">Room</h3>';
   		inner_html += '<p class="lead" id="name" >房間名稱:'+data.Name+'<br>運動類型:'+data.Type+'<br>人數限制:'+data.Maxmember +'</p> </div>';
   		inner_html +='<div class="img-overlay" align=center > <div class="inline-button"  style="position:absolute; top:100px; left:10px; " >';
   		inner_html   +='<input type="button" style="position:absolute; left:150px; top:35px;" class="btn-light hvr-rectangle-out Auto" data-toggle="modal" data-target="#exampleModalLong'+count+'" id="'+count+'" value="詳細資料">';
		inner_html += '	</div></div> </div> </div> </div>';
   		return inner_html;
    }

    });
    </script>


  <footer class="text-muted">
    <div class="container">
      <p class="float-right">
        <a href="#">Back to top</a>
      </p>
      <p>Album example is &copy; Bootstrap, but please download and customize it for yourself!</p>
      <p>New to Bootstrap? <a href="https://getbootstrap.com/">Visit the homepage</a> or read our <a
          href="/docs/4.3/getting-started/introduction/">getting started guide</a>.</p>
    </div>
  </footer>
</body>

</html>
